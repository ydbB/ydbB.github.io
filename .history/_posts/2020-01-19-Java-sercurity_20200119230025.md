---
layout:  post
title: 如何写出安全的 Java 代码？
subtitle: 一切都毫无意义
---
问题32： Java 程序员怎么写出安全的代码？

### 典型回答
我们可以用特定的安全类型为例，如拒绝服务(DoS)攻击，来分析 Java 开发者应该怎么保证代码安全。

拒绝服务攻击，也称为“洪泛攻击”，常见形式为发送大量请求，导致目标服务器的资源被耗尽，无法为其他用户提高正常的服务。

从 Java 语言的角度应该更关注的是程序级别的攻击，利用 Java JVM 和 应用的瑕疵，进行低成本的 Dos 攻击，这也是写出安全代码，应该考虑的：
* 如果使用的是早期的 JDK 和 Applet，攻击者构建合法但恶劣的程序比较容易，将其线程优先级设置为最高，做一些看起来无害但空耗资源的事情。幸运的是类似技术已经逐步退出历史舞台，在 JDK 9 以后，相关模块就已经被移除。
* 哈希碰撞攻击，就是个典型的例子，对方可以轻易消耗系统有限的 CPU 和线程资源。从这个角度思考，类似加密、解密、图形处理等计算密集型任务，都要防范被恶意滥用，以免攻击者通过直接调用或者间接触发方式，消耗系统资源。
* 利用 Java 构建类似上传文件或者其他接受输入的服务，需要对消耗系统内存或存储的上限有所控制，因为我们不能将系统安全依赖于用户的合理使用。其中特别注意的是涉及解压缩功能时，就需要防范Zip bomb等特定攻击。
* Java 程序中需要明确释放的资源有很多种，比如文件描述符、数据库连接，甚至是再入锁，任何情况下都应该保证资源释放成功。

### 考点分析

在后面会循序渐进探讨 Java 安全编程，这里面没有什么黑科技，只有规范的开发标准，很多安全问题其实是态度问题，取决于你是否真的认真对待它。

* 从一些经典的代码片出发，分析一些容易被人忽略的安全问题，介绍安全问题频发的热点场景，如 Java 序列和反序列化
* 从软件生命周期的角度，探讨设计、开发、测试、部署等不同阶段，有哪些常见的安全策略或工具。

### 知识扩展

一个简单的问题：
~~~ java

// a, b, c都是int类型的数值
if (a + b < c) {
// …
}
~~~

这里的问题是类型溢出，在特定情况可能会导致严重的安全漏洞。

从语言特性来说，Java 和 JVM 提供了很多基础性的改进，相比于传统的 C、C++ 等语言，对于数组越界等处理要完善的多，原生的避免了缓冲区溢出等攻击方式，提高了软件的安全性。但这并不代表完全杜绝了问题，Java 程序可能调用本地代码，也就是 JNI 技术，错误的数值可能导致 C/C++ 层面的数据越界等问题，这是很危险的。所以，上面的条件判断，需要判断其数值范围，例如，写成类似下面结构。

另外一个例子：
~~~ java

try {
// 业务代码
} catch (Exception e) {
throw new RuntimeException(hostname + port + “ doesn’t response”);
}
~~~

这段代码将敏感信息包含在异常消息中，尽量少暴露信息，也是保证安全的基本原则之一。即使我们并不认为某个信息有安全风险，我的建议也是如果没有必要，不要暴露出来。