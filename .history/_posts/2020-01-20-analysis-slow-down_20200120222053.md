---
layout: post
title: 后台程序突然变慢，说出你的诊断思路？
subtitle: 如果结果不如你所愿，就在尘埃落定之前奋力一搏！！！
---

问题33：后台服务“变慢”，谈谈你的诊断思路。

### 典型回答

首先需要对这个问题进行定位：
* 服务是突然变慢还是长时间运行后变慢，类似问题是否重复出现？
* “慢”的定义是什么？我能理解为系统对其他方面的反应延迟变长吗？

第二，理清问题的症状，这更便于定位具体原因，下面是常见的一些思路：
* 问题可能来自于 Java 程序本身，也可能是受到其他服务的影响，初始判断可以先确定是否发生了意外的程序错误，如果有，这个异就是能就是突破点；如果没有，就先检查系统级别的资源等情况，监控 CPU、内存等资源是否被其他进程大量占用，并且这种占用是否不符合系统正常运行状况。
* 监控 Java 服务自身，例如 GC 日志里面是否观察到 Full GC 等恶劣情况出现，或者是否 Minor GC 在变长等；利用 jstat 等工具，获取内存使用的统计信息也是个常用手段；利用 jstack 等工具检查是否出现死锁等。
* 如果还不能确定具体问题，对应用进行 Profiling 也是个办法，但因为它会对系统产生侵入性，如果不是非常必要，大多数情况下并不建议在生产系统进行。
* 定位了程序错误或者 JVM 配置的问题后，就可以采取相应的补救措施，然后验证是否解决，否则还需要重复上面部分过程。考点分析

### 考点分析

回答从两方面出发：
* 明确问题的定义，确认自己理解正确在进行回答
* 从系统、应用的不同角度、不同层次，逐步将问题域尽量缩小，隔离出真实原因。具体步骤未必千篇一律，在处理过较多这种问题之后，经验会令你的直觉分外敏感。

面试官可能会针对某个角度的诊断深入询问，兼顾工作和面试的需求，我会针对下面一些方面进行介绍。目的是让你对性能分析有个整体的印象，在遇到特定领域问题时，即使不知道具体细节的工具和手段，至少也可以找到探索、查询的方向。我将介绍业界常见的性能分析方法论。

* 知识扩展主要介绍业界常见的性能分析方法论。
* 从系统分析到 JVM、应用性能分析，把握整体思路和主要工具。对于线程状态、JVM 内存使用等很多方面；

### 知识扩展

先了解一下业内最广泛的性能分析规范：

根据架构进行分析，分布式和大型单体应用也存在思路的区别，分布式的系统性能瓶颈更加集中，传统意义的调优也是基于单体应用的，Charlie Hunt 曾将其方法论总结为两类：

* 自上而下。从应用的顶层，逐步深入到具体的不同模块，或者更近一步的技术细节单元，找到可能的问题和解决办法。这是最常见的性能分析思路，也是大多数工程师的选择。
* 自下而上。从类似 CPU 这种硬件底层，判断类似Cache-Miss之类的问题和调优机会，出发点是指令级别优化。这往往是专业的性能工程师才能掌握的技能，并且需要专业工具配合，大多数是移植到新的平台上，或需要提供极致性能时才会进行。

我所给出的回答，首先是试图排除功能性错误，然后就是典型的自上而下分析思路。

下面看一下