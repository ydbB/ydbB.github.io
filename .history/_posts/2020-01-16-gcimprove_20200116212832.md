---
layout: post
title: GC 调优思路
subtitle: 不做则已,做就要做到最好!!!
---

今天选取的是新版 JDK 默认 G1 GC 作为重点讲解,并且从调优实践的角度,分析典型场景和调优思想.

问题28:你的 GC 调优思路?

### 典型回答
谈到调优,针对特定场景,特定目的的事情;对于 GC 调优来说,首先得清楚目标是什么? 从性能角度看,主要是三方面,内存占用,延迟和吞吐量.

基本调优的思路为:
* 理解应用需求和问题,确定调优目标.
* 掌握 JVM 和 GC 的状态,定位具体问题,确定真有 GC 调优的必要.具体调优方法有多种,如通过 jstat 等工具查看 GC 的状态,可以开启 GC 日志,或者利用操作系统提供的诊断工具等.
* 思考选择的 GC 类型是否符合我们的应用特征,如果是,具体问题表现在哪里?是 Minor GC 过长,还是 Mixed GC 出现异常停顿状况;如果不是,则考虑切换到什么模型.
* 通过分析确定具体调整的参数或者软硬件配置.
* 验证是否达到调优的目的,如果达到,则考虑结束调优,否则重复完成分析,调整,验证的过程.

### 考点分析

很多 JVM 的调优需求,最终都会落到 GC 调优或者预期相关.

真正快速定位和解决问题,需要掌握 JVM 和 GC 知识,以及实践调优的经验总结,有点时候甚至是源自经验积累的直觉判断.面试官可能还会问项目中的真实问题,如果你可以清楚,简要的介绍上下文,然后将诊断思路和调优实践表达出来,会是不错的加分项.

为了更好调优,需要了解:
* 涉及具体的 GC 类型,JVM 的表现要更加复杂, G1已经新版 JDK　默认的　GC　选择，因此值得深入了解．
* G1 在不断的发展中,因此也需要注意演进变化.
* 从 GC 调优实践的角度,理解通用问题的调优思路和手段.

### 知识扩展

从整体上了解 G1 GC 的内部结构和机制.

从年代的角度看, G1 存在相同的年代概念,但其内部是类似棋盘的 region 组成.
region 大小一致, JVM 会尽量划分 2048 个左右同等大小的 region.

在 G1 的实现中,年代是个逻辑概念，具体体现在，一部分 region 是作为 Eden，一部分作为 Survivor，除了意料之中的 Old region，G1 会将超过 region 50% 大小的对象（在应用中，通常是 byte 或 char 数组）归类为 Humongous 对象.

region 设计中的副作用:
* region 的大小很难和大对象保持一致,会造成空间浪费.Hum